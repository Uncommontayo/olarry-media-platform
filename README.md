# larry-media-api (Azure Functions backend) üîß

Small Azure Functions backend for an image-sharing app. Handles upload, list, like, delete, and lightweight AI captions. Core logic lives in [function_app.py](function_app.py).

---

## Features ‚úÖ

- Stores image binaries in Azure Blob Storage (container `images`).
- Issues short-lived SAS URLs so images can be used directly in `<img>` tags.
- CORS enabled for development (default `*`).
- Stateless HTTP endpoints under `/api/<route>` when running locally or deployed.

---

## Prerequisites üß∞

- Python 3.10+
- Azure Functions Core Tools
- Azure Storage account and connection string

---

## Quick start (local) üöÄ

1. Create and activate a virtual environment (recommended `.venv`).
2. Install dependencies: `python -m pip install -r requirements.txt` (or run the VS Code task `pip install (functions)`).
3. Configure secrets: add `STORAGE_CONNECTION_STRING` to `local.settings.json` or your shell environment. Example snippet:

   ```json
   {
     "IsEncrypted": false,
     "Values": {
       "AzureWebJobsStorage": "UseDevelopmentStorage=true",
       "FUNCTIONS_WORKER_RUNTIME": "python",
       "STORAGE_CONNECTION_STRING": "<your-connection-string>"
     }
   }
   ```

4. Start the Functions host: `func host start` (or the VS Code task `func: host start`).

Local base URL: `http://localhost:7071/api/<route>`.

---

## API reference üåê

- **POST** `/api/upload_media` ‚Äî binary body; query params: `caption` (optional), `username` (optional). Response: `{ "name": "<blob-name>" }`.
- **GET** `/api/list_media` ‚Äî returns an array of posts: `{ name, url, caption, username, likes, uploaded_at }` where `url` is SAS-protected.
- **POST** `/api/like_media?name=<blob-name>` ‚Äî increments likes metadata. Response: `{ "likes": <number> }`.
- **DELETE** `/api/delete_media?name=<blob-name>` ‚Äî deletes the blob. Response: `{ "deleted": "<name>" }`.
- **GET** `/api/ai_caption?name=<blob-name>` ‚Äî returns a generated caption. Response: `{ "caption": "..." }`.

---

## Example calls (curl) üíª

Upload (binary body):

```bash
curl -X POST "http://localhost:7071/api/upload_media?username=alice&caption=hi" \
  --data-binary @myimage.jpg \
  -H "Content-Type: image/jpeg"
```

List:

```bash
curl "http://localhost:7071/api/list_media"
```

Like:

```bash
curl -X POST "http://localhost:7071/api/like_media?name=<blob-name>"
```

Delete:

```bash
curl -X DELETE "http://localhost:7071/api/delete_media?name=<blob-name>"
```

AI caption:

```bash
curl "http://localhost:7071/api/ai_caption?name=<blob-name>"
```

---

## Notes & security ‚ö†Ô∏è

- SAS tokens expire in 2 hours (generated by `list_media`).
- CORS is permissive for development; tighten allowed origins for production.
- Keep `STORAGE_CONNECTION_STRING` secret and out of source control.

---

Need more detail? See [function_app.py](function_app.py).
