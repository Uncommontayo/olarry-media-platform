# larry-media-api (Azure Functions backend) üîß

Simple Azure Functions backend for an image-sharing app. Implements upload, list, like, delete, and AI caption endpoints. See implementation in `function_app.py`.

---

## What it does ‚úÖ

- Stores image files in an Azure Blob Storage container (`images`).
- Exposes these HTTP endpoints (routes are under `/api/<route>` when running locally or deployed):
  - `POST /api/upload_media` ‚Äî Upload image bytes in the request body. Optional query params: `caption`, `username`. Returns `{ "name": "<blob-name>" }`.
  - `GET /api/list_media` ‚Äî Returns posts with metadata and a short-lived SAS `url` for each image.
  - `POST /api/like_media?name=<blob-name>` ‚Äî Increments `likes` (stored in blob metadata) and returns `{ "likes": <number> }`.
  - `DELETE /api/delete_media?name=<blob-name>` ‚Äî Deletes the specified blob and returns `{ "deleted": "<name>" }`.
  - `GET /api/ai_caption?name=<blob-name>` ‚Äî Returns a generated caption for the image.
- CORS is enabled (development default: `*`), allowing browser-based frontends to call these endpoints directly.

---

## How the frontend connects üí°

- Local host URL: `http://localhost:7071/api/<route>` (Azure Functions local host).
- `list_media` returns a `url` field (SAS token appended) that can be used directly as an `<img src="...">`.

Example requests:

Upload (binary body):

```
curl -X POST "http://localhost:7071/api/upload_media?username=alice&caption=hi" \
  --data-binary @myimage.jpg \
  -H "Content-Type: application/octet-stream"
```

List:

```
curl "http://localhost:7071/api/list_media"
```

Like:

```
curl -X POST "http://localhost:7071/api/like_media?name=<blob-name>"
```

Delete:

```
curl -X DELETE "http://localhost:7071/api/delete_media?name=<blob-name>"
```

AI caption:

```
curl "http://localhost:7071/api/ai_caption?name=<blob-name>"
```

---

## Local development üîß

1. Create and activate a Python virtual environment (recommended `.venv`).
2. Install dependencies: `python -m pip install -r requirements.txt` (or use the provided VS Code task).
3. Add `STORAGE_CONNECTION_STRING` to `local.settings.json` or your environment with your Azure Storage connection string.
4. Start the Functions host: `func host start` (or use the VS Code task `func: host start`).

---

## Notes & security ‚ö†Ô∏è

- SAS tokens expire (2 hours) as generated by `list_media`.
- CORS is permissive for development; restrict origins in production.
- Keep `STORAGE_CONNECTION_STRING` secret and out of source control.

---

For implementation details, inspect `function_app.py`.
