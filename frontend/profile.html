<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile - O'larry</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #E8E8E8;
      color: #1A1A1A;
      min-height: 100vh;
    }

    /* Navigation */
    .navbar {
      background: #2A2A2A;
      border-bottom: 1px solid #D0D0D0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 12px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 24px;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 32px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      color: #F5F5F5;
    }

    .logo-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #8B8B8B, #4A90E2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
    }

    .logo-text {
      font-size: 22px;
      font-weight: 700;
    }

    .nav-link {
      color: #B8B8B8;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .nav-link:hover {
      background: rgba(255,255,255,0.1);
      color: #F5F5F5;
    }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .btn-logout {
      background: #E74C3C;
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-logout:hover {
      background: #C0392B;
    }

    /* Profile Header */
    .profile-header {
      background: linear-gradient(135deg, #2A2A2A, #4A90E2);
      padding: 60px 24px 40px;
      color: #fff;
      border-bottom: 4px solid #4A90E2;
    }

    .profile-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: flex-end;
      gap: 32px;
    }

    .profile-avatar {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: linear-gradient(135deg, #8B8B8B, #4A90E2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 60px;
      font-weight: bold;
      color: #fff;
      border: 5px solid #fff;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      flex-shrink: 0;
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .avatar-upload-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 14px;
      font-weight: 600;
      backdrop-filter: blur(2px);
    }

    .profile-avatar:hover .avatar-upload-overlay {
      display: flex;
    }

    .profile-info {
      flex: 1;
    }

    .profile-username {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .profile-role {
      display: inline-block;
      background: rgba(255,255,255,0.2);
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 16px;
      backdrop-filter: blur(10px);
    }

    .profile-stats {
      display: flex;
      gap: 32px;
      margin-top: 20px;
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 700;
    }

    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }

    .profile-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .btn-edit {
      background: #fff;
      color: #2A2A2A;
      border: none;
      padding: 10px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-edit:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    /* Content Section */
    .content {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 24px;
    }

    .tabs {
      display: flex;
      gap: 8px;
      border-bottom: 2px solid #D0D0D0;
      margin-bottom: 32px;
    }

    .tab {
      padding: 12px 24px;
      background: none;
      border: none;
      font-size: 16px;
      font-weight: 600;
      color: #6B6B6B;
      cursor: pointer;
      position: relative;
      transition: all 0.2s;
    }

    .tab:hover {
      color: #4A90E2;
    }

    .tab.active {
      color: #4A90E2;
    }

    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: #4A90E2;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Media Grid */
    .media-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 24px;
    }

    .media-card {
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.2s;
      cursor: pointer;
    }

    .media-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }

    .media-thumbnail {
      position: relative;
      padding-bottom: 100%;
      background: #D0D0D0;
      overflow: hidden;
    }

    .media-thumbnail img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .media-content {
      padding: 16px;
    }

    .media-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: #1A1A1A;
    }

    .media-stats {
      display: flex;
      gap: 16px;
      font-size: 14px;
      color: #6B6B6B;
    }

    .loading {
      text-align: center;
      padding: 60px;
      color: #6B6B6B;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #D0D0D0;
      border-top-color: #4A90E2;
      border-radius: 50%;
      margin: 0 auto 16px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: #6B6B6B;
    }

    .empty-state h3 {
      font-size: 24px;
      margin-bottom: 12px;
      color: #1A1A1A;
    }

    /* Edit Profile Modal */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(42, 42, 42, 0.85);
      backdrop-filter: blur(4px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: #F5F5F5;
      border-radius: 16px;
      padding: 32px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .modal-header h2 {
      font-size: 24px;
      color: #1A1A1A;
    }

    .btn-close {
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: #666;
      padding: 0;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #1A1A1A;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #D0D0D0;
      border-radius: 8px;
      font-family: inherit;
      font-size: 14px;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .avatar-upload-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      border: 2px dashed #D0D0D0;
    }

    .edit-avatar-preview {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(135deg, #8B8B8B, #4A90E2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 40px;
      font-weight: bold;
      overflow: hidden;
      position: relative;
    }

    .edit-avatar-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .file-input-wrapper {
      position: relative;
      overflow: hidden;
    }

    .file-input-wrapper input[type="file"] {
      position: absolute;
      opacity: 0;
      cursor: pointer;
      width: 100%;
      height: 100%;
    }

    .btn-file {
      padding: 8px 16px;
      background: #4A90E2;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }

    .btn-cancel {
      background: #D0D0D0;
      color: #1A1A1A;
      border: none;
      padding: 10px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-save {
      background: #4A90E2;
      color: #fff;
      border: none;
      padding: 10px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-save:hover {
      background: #357ABD;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-left">
        <a href="/" class="logo">
          <div class="logo-circle">O</div>
          <span class="logo-text">O'larry</span>
        </a>
        <a href="/" class="nav-link">Feed</a>
        <a href="/profile.html" class="nav-link">Profile</a>
      </div>
      <div class="nav-right">
        <button class="btn-logout" onclick="handleLogout()">Logout</button>
      </div>
    </div>
  </nav>

  <!-- Profile Header -->
  <div class="profile-header">
    <div class="profile-container">
      <div class="profile-avatar" id="profileAvatar" onclick="handleAvatarClick()">
        <span id="avatarInitial">U</span>
        <div class="avatar-upload-overlay" id="avatarOverlay">
          üì∑ Change Photo
        </div>
      </div>
      <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="uploadAvatar(event)">
      <div class="profile-info">
        <h1 class="profile-username" id="profileUsername">@username</h1>
        <span class="profile-role" id="profileRole">Consumer</span>
        <div class="profile-stats">
          <div class="stat">
            <div class="stat-value" id="postsCount">0</div>
            <div class="stat-label">Posts</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="likesCount">0</div>
            <div class="stat-label">Likes</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="commentsCount">0</div>
            <div class="stat-label">Comments</div>
          </div>
        </div>
        <div class="profile-actions" id="profileActions">
          <button class="btn-edit" onclick="openEditModal()">‚úèÔ∏è Edit Profile</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="content">
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('posts')">Posts</button>
      <button class="tab" onclick="switchTab('liked')">Liked</button>
    </div>

    <!-- Loading -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Loading profile...</p>
    </div>

    <!-- Posts Tab -->
    <div class="tab-content active" id="postsTab">
      <div class="media-grid" id="postsGrid"></div>
      <div class="empty-state" id="postsEmpty" style="display: none;">
        <h3>No posts yet</h3>
        <p>Share your first post with the community!</p>
      </div>
    </div>

    <!-- Liked Tab -->
    <div class="tab-content" id="likedTab">
      <div class="media-grid" id="likedGrid"></div>
      <div class="empty-state" id="likedEmpty" style="display: none;">
        <h3>No liked posts</h3>
        <p>Start liking posts to see them here!</p>
      </div>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Proavatar-upload-section">
          <div class="edit-avatar-preview" id="editAvatarPreview">
            <span id="editAvatarInitial">U</span>
          </div>
          <div class="file-input-wrapper">
            <button type="button" class="btn-file">Choose Profile Picture</button>
            <input type="file" id="editAvatarInput" accept="image/*" onchange="previewAvatar(event)">
          </div>
          <small style="color: #6B6B6B;">JPG, PNG or GIF (Max 10MB)</small>
        </div>
        <div class="file</h2>
        <button class="btn-close" onclick="closeEditModal()">&times;</button>
      </div>
      <form id="editForm" onsubmit="saveProfile(event)">
        <div class="form-group">
          <label>Display Name</label>
          <input type="text" id="editDisplayName" placeholder="Your name" />
        </div>
        <div class="form-group">
          <label>Bio</label>
          <textarea id="editBio" placeholder="Tell us about yourself..."></textarea>
        </div>
        <div class="form-group">
          <label>Location</label>
          <input type="text" id="editLocation" placeholder="Your location" />
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" onclick="closeEditModal()">Cancel</button>
          <button type="submit" class="btn-save">Save Changes</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:7071/api';
    let currentUser = null;
    let viewingUsername = null;
    let profilePicture = null;

    // Get username from URL or use current user
    async function init() {
      const urlParams = new URLSearchParams(window.location.search);
      viewingUsername = urlParams.get('user');
      
      if (!viewingUsername) {
        viewingUsername = localStorage.getItem('username');
      }

      if (!viewingUsername) {
        window.location.href = '/login.html';
        return;
      }

      currentUser = localStorage.getItem('username');
      
      // Verify token and refresh role from database
      await verifyToken();
      
      loadProfile();
    }

    async function verifyToken() {
      try {
        const response = await fetch(`${API_BASE}/verify_token`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('authToken')}`,
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) {
          console.error('Token verification failed');
          localStorage.clear();
          window.location.href = '/login.html';
          return;
        }

        const data = await response.json();
        
        if (!data.valid) {
          localStorage.clear();
          window.location.href = '/login.html';
          return;
        }

        // Update localStorage with current role from database
        localStorage.setItem('userRole', data.role);
        localStorage.setItem('username', data.username);
        
        console.log('‚úÖ Token verified. Role:', data.role, 'Username:', data.username);
      } catch (error) {
        console.error('Token verification error:', error);
        localStorage.clear();
        window.location.href = '/login.html';
      }
    }

    async function loadProfile() {
      try {
        // Load user's posts
        const response = await fetch(`${API_BASE}/list_media`, {
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('authToken')}`
          }
        });

        if (!response.ok) throw new Error('Failed to load profile');

        const allMedia = await response.json();
        
        // Find profile picture
        const profilePic = Array.isArray(allMedia) 
          ? allMedia.find(m => m.username === viewingUsername && m.caption === '__profile_pic__')
          : null;

        // Filter out profile picture from regular posts
        const userMedia = Array.isArray(allMedia) 
          ? allMedia.filter(m => m.username === viewingUsername && m.caption !== '__profile_pic__')
          : [];

        // Get the role - if viewing own profile use localStorage, otherwise determine from content
        let userRole = 'consumer';
        if (currentUser === viewingUsername) {
          userRole = localStorage.getItem('userRole') || 'consumer';
          console.log('üìã Viewing own profile - Role from localStorage:', userRole);
          console.log('üìã currentUser:', currentUser, 'viewingUsername:', viewingUsername);
        } else {
          // Other users: creators have uploads, consumers don't
          userRole = userMedia.length > 0 ? 'creator' : 'consumer';
          console.log('üë§ Viewing other user - Determined role:', userRole, 'Media count:', userMedia.length);
        }

        // Update profile info
        document.getElementById('profileUsername').textContent = `@${viewingUsername}`;
        document.getElementById('profileRole').textContent = userRole.charAt(0).toUpperCase() + userRole.slice(1);
        console.log('‚úÖ Profile role set to:', userRole);
        
        // Display profile picture or initial
        const avatarContainer = document.getElementById('profileAvatar');
        const avatarInitial = document.getElementById('avatarInitial');
        
        if (profilePic) {
          profilePicture = profilePic;
          // Direct Azure Blob Storage URL from backend response
          const imgUrl = profilePic.url;
          avatarContainer.innerHTML = `
            <img src="${imgUrl}" alt="Profile picture" onerror="this.style.display='none'">
            <div class="avatar-upload-overlay" id="avatarOverlay">
              üì∑ Change Photo
            </div>
          `;
        } else {
          avatarInitial.textContent = viewingUsername[0]?.toUpperCase() || 'U';
        }

        // Calculate stats
        const totalPosts = userMedia.length;
        const totalLikes = userMedia.reduce((sum, m) => sum + (m.likes || 0), 0);
        const totalComments = userMedia.reduce((sum, m) => sum + (m.comment_count || m.comments || 0), 0);

        document.getElementById('postsCount').textContent = totalPosts;
        document.getElementById('likesCount').textContent = totalLikes;
        document.getElementById('commentsCount').textContent = totalComments;

        // Show/hide edit button and avatar overlay
        if (currentUser === viewingUsername) {
          document.getElementById('profileActions').style.display = 'flex';
          const overlay = document.getElementById('avatarOverlay');
          if (overlay) overlay.style.display = 'flex';
        } else {
          document.getElementById('profileActions').style.display = 'none';
          const overlay = document.getElementById('avatarOverlay');
          if (overlay) overlay.remove();
          document.getElementById('profileAvatar').style.cursor = 'default';
        }

        // Display posts
        displayPosts(userMedia);
        
        document.getElementById('loading').style.display = 'none';
      } catch (error) {
        console.error('Error loading profile:', error);
        document.getElementById('loading').innerHTML = '<p style="color: #E74C3C;">Failed to load profile</p>';
      }
    }

    function displayPosts(media) {
      const grid = document.getElementById('postsGrid');
      const empty = document.getElementById('postsEmpty');

      if (media.length === 0) {
        empty.style.display = 'block';
        grid.style.display = 'none';
        return;
      }

      empty.style.display = 'none';
      grid.style.display = 'grid';
      grid.innerHTML = '';

      media.forEach(item => {
        const card = document.createElement('div');
        card.className = 'media-card';
        card.onclick = () => window.location.href = `/?media=${encodeURIComponent(item.name)}`;

        // Direct Azure Blob Storage URL from backend response
        const mediaUrl = item.url;

        card.innerHTML = `
          <div class="media-thumbnail">
            <img src="${mediaUrl}" alt="${item.title || item.caption || 'Media'}" 
                 onerror="this.style.display='none'">
          </div>
          <div class="media-content">
            <div class="media-title">${item.title || item.caption || 'Untitled'}</div>
            <div class="media-stats">
              <span>‚ù§Ô∏è ${item.likes || 0}</span>
              <span>üí¨ ${item.comment_count || item.comments || 0}</span>
            </div>
          </div>
        `;

        grid.appendChild(card);
      });
    }

    function handleAvatarClick() {
      // Only allow uploading if viewing own profile
      if (currentUser === viewingUsername) {
        document.getElementById('avatarInput').click();
      }
    }

    async function uploadAvatar(event) {
      const file = event.target.files[0];
      if (!file) return;

      if (file.size > 10 * 1024 * 1024) {
        alert('File size must be less than 10MB');
        return;
      }

      try {
        // Delete old profile picture if exists
        if (profilePicture) {
          await fetch(`${API_BASE}/delete_media?name=${encodeURIComponent(profilePicture.name)}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${localStorage.getItem('authToken')}`
            }
          });
        }

        // Upload new profile picture with special caption
        const formData = new FormData();
        formData.append('file', file);

        const params = new URLSearchParams({
          title: 'Profile Picture',
          caption: '__profile_pic__',
          username: currentUser,
          location: '',
          tagged_people: ''
        });

        const response = await fetch(`${API_BASE}/upload_media?${params}`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('authToken')}`
          },
          body: formData
        });

        if (!response.ok) throw new Error('Upload failed');

        // Reload profile to show new avatar
        loadProfile();
      } catch (error) {
        console.error('Error uploading avatar:', error);
        alert('Failed to upload profile picture. Please try again.');
      }
    }

    function previewAvatar(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        const preview = document.getElementById('editAvatarPreview');
        preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
      };
      reader.readAsDataURL(file);
    }

    function openEditModal() {
      // Load current profile picture into edit modal
      const editPreview = document.getElementById('editAvatarPreview');
      const editInitial = document.getElementById('editAvatarInitial');
      
      if (profilePicture) {
        // Direct Azure Blob Storage URL from backend response
        const imgUrl = profilePicture.url;
        editPreview.innerHTML = `<img src="${imgUrl}" alt="Profile picture">`;
      } else {
        editInitial.textContent = viewingUsername[0]?.toUpperCase() || 'U';
      }
      
      document.getElementById('editModal').classList.add('show');
    }

    function closeEditModal() {
      document.getElementById('editModal').classList.remove('show');
      // Reset file input
      document.getElementById('editAvatarInput').value = '';
    }

    async function saveProfile(event) {
      event.preventDefault();
      
      const fileInput = document.getElementById('editAvatarInput');
      const file = fileInput.files[0];
      
      if (file) {
        await uploadAvatarFromModal(file);
      }
      
      // TODO: Save other profile fields (display name, bio, location)
      alert('Profile updated!');
      closeEditModal();
      loadProfile();
    }

    async function uploadAvatarFromModal(file) {
      if (file.size > 10 * 1024 * 1024) {
        alert('File size must be less than 10MB');
        return;
      }

      try {
        // Delete old profile picture if exists
        if (profilePicture) {
          await fetch(`${API_BASE}/delete_media?name=${encodeURIComponent(profilePicture.name)}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${localStorage.getItem('authToken')}`
            }
          });
        }

        // Upload new profile picture
        const formData = new FormData();
        formData.append('file', file);

        const params = new URLSearchParams({
          title: 'Profile Picture',
          caption: '__profile_pic__',
          username: currentUser,
          location: '',
          tagged_people: ''
        });

        const response = await fetch(`${API_BASE}/upload_media?${params}`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('authToken')}`
          },
          body: formData
        });

        if (!response.ok) throw new Error('Upload failed');
      } catch (error) {
        console.error('Error uploading avatar:', error);
        throw error;
      }
    }

    function switchTab(tab) {
      // Update tab buttons
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');

      // Update tab content
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById(tab + 'Tab').classList.add('active');

      if (tab === 'liked') {
        // Load liked posts (placeholder for now)
        document.getElementById('likedEmpty').style.display = 'block';
      }
    }

    function openEditModal() {
      document.getElementById('editModal').classList.add('show');
    }

    function closeEditModal() {
      document.getElementById('editModal').classList.remove('show');
    }

    function saveProfile(event) {
      event.preventDefault();
      // TODO: Implement profile update API call
      alert('Profile updated! (API integration pending)');
      closeEditModal();
    }

    function handleLogout() {
      console.log('üö™ Logout button clicked');
      try {
        localStorage.removeItem('authToken');
        localStorage.removeItem('userRole');
        localStorage.removeItem('username');
        console.log('‚úÖ LocalStorage cleared');
        window.location.href = '/login.html';
      } catch (error) {
        console.error('‚ùå Logout error:', error);
        // Force redirect anyway
        window.location.href = '/login.html';
      }
    }

    // Make functions globally accessible for onclick handlers
    window.handleLogout = handleLogout;
    window.handleAvatarClick = handleAvatarClick;
    window.uploadAvatar = uploadAvatar;
    window.openEditModal = openEditModal;
    window.closeEditModal = closeEditModal;
    window.switchTab = switchTab;
    window.saveProfile = saveProfile;

    // Initialize
    init();
  </script>
</body>
</html>
